---
import type { EditablePost } from "@/pages/admin/_lib/types";
import EditDate from "./EditDate.astro";
import EditDraft from "./EditDraft.astro";
import EditTags from "./EditTags.astro";
import EditTitle from "./EditTitle.astro";

interface Props {
	slug: string;
	initialData: EditablePost;
}

const { slug, initialData } = Astro.props;
---

<form
	id="edit-form"
	class="flex h-full flex-col gap-4"
	data-slug={slug}
	data-sha={initialData.sha}
>
	<div class="flex h-full flex-1 flex-col gap-4 md:grid md:grid-cols-2">
		<div class="flex flex-col gap-4">
			<div
				class="flex flex-col gap-4 rounded border border-gray-200 bg-white p-4"
			>
				<EditTitle value={initialData.frontmatter.title} />
				<EditDate value={initialData.frontmatter.date} />
				<EditTags value={initialData.frontmatter.tags} />
				<EditDraft value={initialData.frontmatter.draft} />
			</div>
		</div>

		<div class="flex h-full flex-col gap-2">
			<label for="body" class="text-base-content text-sm font-bold"
				>Body (Markdown)</label
			>
			<textarea
				id="body"
				name="body"
				class="textarea textarea-bordered h-full w-full flex-1 resize-none font-mono text-sm leading-normal"
				spellcheck="false">{initialData.body}</textarea
			>
		</div>
	</div>

	<div class="border-base-200 flex justify-end gap-4 border-t py-2">
		<a href="/admin" class="btn btn-outline"> Cancel </a>
		<button type="submit" class="btn btn-primary">
			<span id="btn-text">Save Changes</span>
		</button>
	</div>
</form>

<script>
	import { setupEditPostForm } from "@/pages/admin/_lib/edit-post.client";
	setupEditPostForm();
</script>
