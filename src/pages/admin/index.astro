---
import { Icon } from "astro-icon/components";
import AdminLayout from "@/pages/admin/_layouts/AdminLayout.astro";
import AdminDashboardHeader from "./_components/AdminDashboardHeader.astro";
import ContentTable from "./_components/ContentTable.astro";
import { loadContentListing } from "./_lib/load-content-listing";

export const prerender = false;

const contentResult = await loadContentListing(Astro.request.headers);
---

<AdminLayout title="Admin">
	<main class="mx-auto max-w-lg px-2">
		<AdminDashboardHeader />

		{
			contentResult.status === "error" ? (
				<div class="bg-error/10 flex items-center gap-3 rounded-xl p-3 text-sm">
					<Icon name="tabler:alert-circle" class="text-error size-5 shrink-0" />
					<span class="text-error">{contentResult.message}</span>
				</div>
			) : (
				<ContentTable entries={contentResult.entries} />
			)
		}
	</main>
</AdminLayout>

<script>
	import { setupAdminDashboard } from "./_lib/admin-dashboard.client";
	setupAdminDashboard();
</script>
