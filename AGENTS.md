# リポジトリガイドライン

## プロジェクト構造とモジュール構成

Astro のソースは `src/` にある。

- `pages/` はルートを定義する。ページになってしまうため、このディレクトリ内にコンポーネントを直接置くことはできない。
- `features/` はFeatureベースのページ内モジュールを保持する。以下ディレクトリはFeatureごとに作成される。
  - `_layouts/` はページレイアウトを定義する。
  - `_components/` は共有 UI を保持する。
  - `_styles/` はカスタムスタイルを保持する。あまり使用しないこと。可能な限り Tailwind を使用し、デザイントークンに追加修正して使用すること。
  - `_lib/` はヘルパーを保持する。ヘルパー関数を書く前に、適切なデータ構造を使用していることを確認すること。

共有のビジュアルは `assets/` に属する。Markdown の記事は `content/blog/` の下に配置され、`src/content.config.ts` からスキーマを継承する。静的ファイルは `public/` を通じて配布する。本番環境の出力は `dist/` に配置され、`wrangler.toml` の Worker 設定を通じてデプロイされる。

## ビルド、テスト、開発コマンド

- `bun install` — Bun で依存関係をインストールする (必須ランタイム)。
- `bun run dev` — ホットリロードで Astro 開発サーバーを起動する。
- `bun run build` — `dist/` に最適化されたバンドルを生成する。
- `bun run preview` — Cloudflare を模倣するためにバンドルをローカルで提供する。
- `bun run check` — プロジェクト全体で Biome のリント/フォーマットチェックを実行する。
- `bun run format` — Biome の修正をインプレースで適用する。

## コーディングスタイルと命名規則

2スペースのインデントと TypeScript 構文を使用する。コンポーネント、レイアウト、フックは PascalCase (`TopCard.astro`, `OGImage.tsx`) を使用し、ユーティリティや設定は、既存のファイルと一致する場合は lowerCamel または kebab-case のままにできる。Tailwind クラスは、リポジトリに既に存在するカスタムブレークポイントプレフィックス (`2x:`, `3x:`) を再利用する必要がある。Biome にスペース、インポート順序、未使用コードのルールを強制させる (`.astro` テンプレートもフォーマットするようになった)。コミットする前に `bun run format` を実行する。

## テストガイドライン

自動テストスイートはない。リンティングと手動検証に頼る。プッシュする前に、`bun run check`、`bun run build`、`bun run preview` を実行して、ランタイムエラー、レイアウトの問題、Cloudflare 固有のリグレッションを捕捉する。コンテンツの編集については、`bun run dev` を介して `http://localhost:4321/<slug>` を確認し、メタデータ (日付、OG 画像) が正しいことを確認する。レビューアが繰り返せるように、PR に手動 QA の手順を文書化する。

## コミットとプルリクエストのガイドライン

コミットは、緩やかな Conventional Commit スタイル (`feat:`, `chore:`, `fix:`) または短い命令形メッセージ (例: 「2025-11-17 の記事名を変更」) に従う。プッシュする前に、ノイズの多い WIP コミットをスカッシュする。プルリクエストには、概要、リンクされた課題、視覚的な調整のスクリーンショット、実行されたコマンド (`bun run check`, `bun run build`)、および設定またはコンテンツの移行に関するメモを含める必要がある。グローバルなレイアウトまたはデプロイ設定に影響する変更は、Astro メンテナーからのレビューをリクエストする必要がある。

## デプロイと設定に関する注意事項

Cloudflare の認証情報とルートは `wrangler.toml` にある。シークレットはソースに保存するのではなく、`bun run wrangler secret put` で更新する。`@astrojs/sitemap` はサイトマップを自動生成するため、必要に応じて新しい動的パスを `astro.config.mjs` に追加する。サードパーティースクリプトは、メインスレッドのパフォーマンスを保護するために `@astrojs/partytown` を通じてロードする.
