---
import AdminLayout from "@/pages/admin/_layouts/AdminLayout.astro";
import AdminDashboardHeader from "./_components/AdminDashboardHeader.astro";
import ContentTable from "./_components/ContentTable.astro";
import { loadContentListing } from "./_lib/load-content-listing";

export const prerender = false;

const contentResult = await loadContentListing(Astro.request.headers);
---

<AdminLayout title="Admin | Content overview">
	<main class="container mx-auto max-w-5xl p-4">
		<AdminDashboardHeader />

		{
			contentResult.status === "error" ? (
				<div role="alert" class="alert alert-error">
					<h3 class="font-bold">Error fetching content</h3>
					<div class="text-xs">{contentResult.message}</div>
				</div>
			) : (
				<ContentTable entries={contentResult.entries} />
			)
		}
	</main>
</AdminLayout>

<script>
	import { setupAdminDashboard } from "./_lib/admin-dashboard.client";
	setupAdminDashboard();
</script>
