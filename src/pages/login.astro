---
import GlobalLayout from "@/app/layouts/GlobalLayout.astro";

export const prerender = false;
---

<GlobalLayout>
	<div class="flex gap-2 p-2">
		<button class="bg-lime-500 p-2" id="login">Login</button>
		<button class="bg-lime-500 p-2" id="logout">Logout</button>
	</div>

	<script>
		const { signIn, signOut } = await import("@/admin/auth/auth-client");
		const loginButton = document.querySelector("#login");
		const logoutButton = document.querySelector("#logout");

		if (!loginButton || !logoutButton) {
			throw new Error("Login or Logout button not found");
		}

		const urlParams = new URLSearchParams(window.location.search);
		const redirectTo = urlParams.get("redirectTo") ?? "/admin";

		loginButton.addEventListener("click", () =>
			signIn.social({
				provider: "github",
				callbackURL: redirectTo,
			}),
		);
		logoutButton.addEventListener("click", () => signOut());
	</script>
</GlobalLayout>
