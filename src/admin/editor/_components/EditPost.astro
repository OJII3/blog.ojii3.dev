---
import type { EditablePost } from "../types";
import EditDate from "./EditDate.astro";
import EditDraft from "./EditDraft.astro";
import EditTags from "./EditTags.astro";
import EditTitle from "./EditTitle.astro";

interface Props {
	slug: string;
	initialData: EditablePost;
}

const { slug, initialData } = Astro.props;
---

<form
	id="edit-form"
	class="flex h-full flex-col gap-4"
	data-slug={slug}
	data-sha={initialData.sha}
>
	<div class="grid min-h-[500px] flex-1 grid-cols-1 gap-4 md:grid-cols-2">
		<div class="flex flex-col gap-4">
			<div
				class="flex flex-col gap-4 rounded border border-gray-200 bg-white p-4"
			>
				<h2 class="text-lg font-bold text-gray-700">Metadata</h2>
				<EditTitle value={initialData.frontmatter.title} />
				<EditDate value={initialData.frontmatter.date} />
				<EditTags value={initialData.frontmatter.tags} />
				<EditDraft value={initialData.frontmatter.draft} />
			</div>
		</div>

		<div class="flex flex-col gap-2">
			<label for="body" class="text-gray-7 text-sm font-bold"
				>Body (Markdown)</label
			>
			<textarea
				id="body"
				name="body"
				class="border-gray-2 bg-gray-0 text-gray-7 focus:ring-accent-500 flex-1 resize-none rounded border p-2 font-mono text-sm outline-none focus:ring-2"
				spellcheck="false">{initialData.body}</textarea
			>
		</div>
	</div>

	<div class="border-gray-2 flex justify-end gap-4 border-t py-2">
		<a
			href="/admin"
			class="text-gray-6 border-gray-2 hover:bg-gray-1 flex items-center rounded border px-4 py-2 text-sm font-medium"
		>
			Cancel
		</a>
		<button
			type="submit"
			class="bg-accent-600 hover:bg-accent-700 flex cursor-pointer items-center gap-2 rounded px-4 py-2 text-sm font-bold text-white shadow-sm disabled:cursor-not-allowed disabled:opacity-50"
		>
			<span id="btn-text">Save Changes</span>
		</button>
	</div>
</form>

<script>
	import { setupEditPostForm } from "../edit-post.client";
	setupEditPostForm();
</script>
