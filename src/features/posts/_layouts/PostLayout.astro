---
import "../_styles/override.css";
import { type CollectionEntry, render } from "astro:content";
import {
	H2_BORDER_COLORS,
	SITE_NAME,
	SITE_URL,
	TEXT_COLORS,
} from "../../../constants";
import GlobalLayout from "../../_layouts/GlobalLayout.astro";
import PostHeader from "../_components/PostHeader.astro";
import PostPrevNext from "../_components/PostPrevNext.astro";

// import Header from "@/components/Header.astro";
// import Footer from "@/components/Footer.astro";
// import Tag from "@/components/Tag.astro";
// import Datetime from "@/components/Datetime.astro";
// import EditPost from "@/components/EditPost.astro";
// import ShareLinks from "@/components/ShareLinks.astro";
// import BackButton from "@/components/BackButton.astro";
// import BackToTopButton from "@/components/BackToTopButton.astro";

export interface Props {
	prevPost: CollectionEntry<"blog"> | null;
	nextPost: CollectionEntry<"blog"> | null;
	post: CollectionEntry<"blog">;
}

const { post, prevPost, nextPost } = Astro.props;

const { title, dateString, color, tags, draft } = post.data;

const { Content } = await render(post);

const titleText = `${title} | ${SITE_NAME}`;
const ogImage = `${SITE_URL}/${post.id}/og-image.png`;
---

<GlobalLayout title={titleText} ogImage={ogImage}>
	<div class="mx-auto max-w-[80ch]">
		<PostHeader color={color} />

		<main transition:name={post.id} class="w-full p-4">
			<h1
				class="mt-4 text-2xl font-bold sm:text-3xl"
				data-pagefind-meta="title"
				data-pagefind-ignore={draft}
			>
				{title}
			</h1>

			<div class="mt-2 mb-8 flex items-center gap-2">
				<span
					aria-hidden="true"
					class="text-sm"
					data-pagefind-meta="date"
					data-pagefind-ignore={draft}>{dateString}</span
				>
			</div>

			<article
				class:list={[
					"prose dark:prose-invert mx-auto mb-16 max-w-none overflow-hidden",
					"prose-code:rounded-sm prose-code:px-1 prose-code:bg-gray-2",
					"prose-h2:pl-2 prose-h2:border-l-4",
					H2_BORDER_COLORS[color],
				]}
				data-pagefind-body={draft ? undefined : true}
				data-pagefind-ignore={draft}
			>
				<Content />
			</article>

			<ul class="my-8 flex flex-wrap gap-2">
				{
					tags?.map((tag) => (
						<li>
							<a
								href={`/search?tag=${tag}`}
								class:list={["px-1 hover:underline", TEXT_COLORS[color]]}
							>
								#
								<span data-pagefind-filter="tag" data-pagefind-ignore={draft}>
									{tag}
								</span>
							</a>
						</li>
					))
				}
			</ul>

			<div
				data-pagefind-ignore="all"
				class="grid grid-cols-1 gap-4 pt-8 pb-4 sm:grid-cols-2"
			>
				{
					prevPost ? (
						<PostPrevNext originalPost={post} targetPost={prevPost} isPrev />
					) : (
						<div />
					)
				}
				{
					nextPost ? (
						<PostPrevNext originalPost={post} targetPost={nextPost} isNext />
					) : (
						<div />
					)
				}
			</div>
		</main>
	</div>
</GlobalLayout>
