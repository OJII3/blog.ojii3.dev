# リポジトリガイドライン

## プロジェクト構造とモジュール構成

Astro のソースは `src/` にあります。`pages/` はルートを定義し、`layouts/` はラッパーをホストし、`components/` は共有 UI を保持し、`lib/` はヘルパーを保持します。共有のビジュアルは `assets/` と `styles/` に属します。Markdown の記事は `content/blog/` の下に配置され、`src/content.config.ts` からスキーマを継承します。静的ファイルは `public/` を通じて配布します。本番環境の出力は `dist/` に配置され、`wrangler.toml` の Worker 設定を通じてデプロイされます。

## ビルド、テスト、開発コマンド

- `bun install` — Bun で依存関係をインストールします (必須ランタイム)。
- `bun run dev` — ホットリロードで Astro 開発サーバーを起動します。
- `bun run build` — `dist/` に最適化されたバンドルを生成します。
- `bun run preview` — Cloudflare を模倣するためにバンドルをローカルで提供します。
- `bun run check` — プロジェクト全体で Biome のリント/フォーマットチェックを実行します。
- `bun run format` — Biome の修正をインプレースで適用します。

## コーディングスタイルと命名規則

2スペースのインデントと TypeScript 構文を使用します。コンポーネント、レイアウト、フックは PascalCase (`TopCard.astro`, `OGImage.tsx`) を使用し、ユーティリティや設定は、既存のファイルと一致する場合は lowerCamel または kebab-case のままにできます。Tailwind クラスは、リポジトリに既に存在するカスタムブレークポイントプレフィックス (`2x:`, `3x:`) を再利用する必要があります。Biome にスペース、インポート順序、未使用コードのルールを強制させます (`.astro` テンプレートもフォーマットするようになりました)。コミットする前に `bun run format` を実行します。

## テストガイドライン

自動テストスイートはありません。リンティングと手動検証に頼ります。プッシュする前に、`bun run check`、`bun run build`、`bun run preview` を実行して、ランタイムエラー、レイアウトの問題、Cloudflare 固有のリグレッションを捕捉します。コンテンツの編集については、`bun run dev` を介して `http://localhost:4321/<slug>` を確認し、メタデータ (日付、OG 画像) が正しいことを確認します。レビューアが繰り返せるように、PR に手動 QA の手順を文書化します。

## コミットとプルリクエストのガイドライン

コミットは、緩やかな Conventional Commit スタイル (`feat:`, `chore:`, `fix:`) または短い命令形メッセージ (例: 「2025-11-17 の記事名を変更」) に従います。プッシュする前に、ノイズの多い WIP コミットをスカッシュします。プルリクエストには、概要、リンクされた課題、視覚的な調整のスクリーンショット、実行されたコマンド (`bun run check`, `bun run build`)、および設定またはコンテンツの移行に関するメモを含める必要があります。グローバルなレイアウトまたはデプロイ設定に影響する変更は、Astro メンテナーからのレビューをリクエストする必要があります。

## デプロイと設定に関する注意事項

Cloudflare の認証情報とルートは `wrangler.toml` にあります。シークレットはソースに保存するのではなく、`bun run wrangler secret put` で更新します。`@astrojs/sitemap` はサイトマップを自動生成するため、必要に応じて新しい動的パスを `astro.config.mjs` に追加します。サードパーティースクリプトは、メインスレッドのパフォーマンスを保護するために `@astrojs/partytown` を通じてロードします。
